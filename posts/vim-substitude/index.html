<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>从例子聊聊vim的替换指令 - Journeyman</title>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=icon href=https://example.comfavicon.png>
<link rel=stylesheet href=/css/style.min.4b2bfb3701049fe0da3e8d6b9d15186ba1dc7e294f0be3e2bca21bb8a330f5dd.css>
<meta property="og:title" content="从例子聊聊vim的替换指令">
<meta property="og:type" content="website">
<meta property="og:url" content="https://example.com/posts/vim-substitude/">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@zerostaticio">
<meta name=twitter:creator content="@zerostaticio">
<link rel=preconnect href=https://fonts.gstatic.com>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel=stylesheet>
</head>
<body class="page frame page-blog-single">
<div id=wrapper class=wrapper>
<div class=header>
<a class=header-logo href=https://example.com>Journeyman</a>
<div class=menu-main>
<ul>
<li class=menu-item-about>
<a href=/pages/about/>About</a>
</li>
<li class=menu-item-posts>
<a href=/posts/>Posts</a>
</li>
</ul>
</div>
</div>
<div class=blog>
<div class=intro>
<h1>从例子聊聊vim的替换指令<span class=dot>.</span></h1>
</div>
<div class=content>
<p>这两日实习期间，要做三个X功能下的子功能，在X功能下已经有F1~Fn，n个子功能，其中间相似度很高，所以新添加三个子功能的工作基本是复制粘贴，但是每个功能有其若干关键词不同。实现这三个功能由我和一位带我的同事共同完成，但是由于vim的替换功能之给力，让我倒是提前完成了我的部分，跟leader说后，他又分配了我一部分，我还是提前半小时左右完成工作摸鱼等下班了。</p>
<p>例如原来已有功能的是XXX，我们要添加的新功能关键词是YYY，那么我们要把其中一个函数从：<code>UpdateXXXFoo</code>改名为<code>UpdateYYYFoo</code>。</p>
<p>涉及的改动大概有如下这两种：</p>
<ol>
<li>涉及整个文件内的改动，例如从<code>XXXFence.go</code>复制出来一个<code>YYYFence.go</code>，这里面的函数、注释、字符串（例如写入日志的）都还是以XXX命名的</li>
<li>涉及在原有文件上增加一部分，例如给新功能注册路由。</li>
</ol>
<p>那么涉及这两种的替换时，vim的替换如何发挥作用呢？</p>
<p>首先我们来看vim的替换的基本用法：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:s/foo/bar/g
</code></pre></div><blockquote>
<p>这个命令把这一行遇到的所有foo替换为bar，如果没有，就什么都不做</p>
<p>:s （冒号是命令的一部分）表示替换命令，是substitute的缩写，然后用斜杠提示替换前的单词<code>foo</code>，再一个斜杠提示替换后的单词<code>bar</code>，再一个斜杠表示替换标志<code>g</code></p>
<p>这个g表示替换这一行的所有foo，如果你指向替换第一个，可以用<code>:s/foo/bar</code>，不过就vim的效率思路，你应该直接用c指令去替换（扯远了）</p>
</blockquote>
<h4 id=能不能给力点啊>能不能给力点啊？</h4>
<p>来到前面这个问题，如果全局里的XXX要替换为YYY怎么办呢？答案是：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:%s/foo/bar/g
</code></pre></div><blockquote>
<p>比上一个命令多的一个百分号，表示在整个文件进行替换</p>
</blockquote>
<p>按照第一种改动，整个文件里的XXX都要改为YYY，可以直接这么操作。</p>
<blockquote>
<p>%是怎么起作用的呢？其实他等价于1,$，也就是从第一行到最后一行生效这个命令（$是最后一行的一个符号），换句话说，上一个命令可以写作</p>
</blockquote>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:1,$s/foo/bar/g
</code></pre></div><p>其实每个人一看到这种命令就有种自然的恐惧感，啊这又是什么，怎么就$都出来了，如果知道下面这个问题，其实<code>1,$</code>也没有那么可怕</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:2,5&lt;命令&gt;
</code></pre></div><p>表示的就是这个命令从第二行到第五行生效，这种<code>x,y</code>表示从第x行到第y行执行接下来的命令是vim命令的一个常用操作</p>
<blockquote>
<p>顺便：<code>.</code>表示的是当前行</p>
</blockquote>
<h4 id=能不能再给力一点啊>能不能再给力一点啊？</h4>
<p>其实在上面这些，大多数现代IDE都有好用的替换功能，例如IDEA的快捷键是<code>Ctrl+R</code>，全局替换对话框是<code>Ctrl+Shift+R</code>，但是至今我都没有找到，如何选中一个区域进行替换，而这时vim依然有这种操作。</p>
<p>区域替换，先来个例子，原来一个文件里就是用来定义枚举量的，文件内容像这样：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=o>...</span>

<span class=nx>RequestXXXOperationA</span><span class=o>:=</span><span class=mi>1</span>
<span class=nx>RequestXXXOperationB</span><span class=o>:=</span><span class=mi>2</span>
<span class=nx>RequestXXXOperationC</span><span class=o>:=</span><span class=mi>3</span>

<span class=o>...</span>
</code></pre></div><p>你添加了一个新功能，也要添加对应的枚举量，于是你先复制了一份<code>XXX</code>关键字的枚举量：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=o>...</span>

<span class=nx>RequestXXXOperationA</span><span class=o>:=</span><span class=mi>1</span>
<span class=nx>RequestXXXOperationB</span><span class=o>:=</span><span class=mi>2</span>
<span class=nx>RequestXXXOperationC</span><span class=o>:=</span><span class=mi>3</span>

<span class=nx>RequestXXXOperationA</span><span class=o>:=</span><span class=mi>1</span>
<span class=nx>RequestXXXOperationB</span><span class=o>:=</span><span class=mi>2</span>
<span class=nx>RequestXXXOperationC</span><span class=o>:=</span><span class=mi>3</span>

<span class=o>...</span>
</code></pre></div><p>现在你不能用全局替换（显然的），如果用IDE替换，免不了先放对光标位置，再输入两个字符串，再点击三下replace这一顿操作</p>
<p>更有效率的方式是什么呢？先用</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>Vjj
</code></pre></div><p>（行可视模式选择，光标在第二个<code>RequestXXXOperationA</code>这一行）当然怎么选中是无所谓的，如果你刚粘贴完，光标在<code>RequestXXXOperationC</code>这一行，<code>Vkk</code>选中他们</p>
<p>这时再按<code>:</code>,你会发现命令里不只出现了冒号，他们是这样的：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:&#39;&lt;,&#39;&gt;
</code></pre></div><blockquote>
<p>这是由vim自动补全的，这里的<code>'&lt;</code>和<code>'></code>共同表示选中的区域（你也能猜到这表示了选中的区域的左右边界），他们和你刚刚看到的<code>2,5</code>表示的没有什么区别，都是限制了接下来命令的范围</p>
</blockquote>
<p>你再接着敲完这个命令：</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>:&#39;&lt;,&#39;&gt;s/foo/bar/g
</code></pre></div><p>这样你就能选中刚才刚复制的部分进行替换了，不会影响到文件的其他部分。</p>
<h4 id=能不能再给力一点啊-1>能不能再给力一点啊？</h4>
<p>其实再说就不是替换命令的部分了，vim的命令存在缓冲区（或者历史记录）</p>
<blockquote>
<p>如果你输入冒号，再按上下键，就能找到你曾经输入过的命令</p>
</blockquote>
<p>这么一来，如果你要复制三个文件并进行替换，并且其中混杂着蛇形命名法和驼峰命名法的关键字，如XxxYyy要替换为AaaBbb，而在另一个部分则是xxx_yyy替换为aaa_bbb，那么重复输入不同的替换词，一遍遍的点击replace将是接下来至少半小时的噩梦。</p>
<p>如果你在命令历史记录找到了合适的命令，不妨直接改一改用于这一次替换，或者你刻意把这个命令写成可以复用的模式就不用改了。</p>
<p>好好利用历史记录将<strong>极大</strong>加快你的替换进度。</p>
<h4 id=结语>结语</h4>
<p>当我们不得不Ctrl-v时，不妨用vim让我们懒一点</p>
<h4 id=一点碎碎念>一点碎碎念</h4>
<p>这种高度重合的代码，是不是应该重构，这是另一个话题。</p>
</div>
</div>
<div class=footer>
<div class=footer-social>
<span class="social-icon social-icon-github">
<a href=https://github.com/chivalryq title=github target=_blank rel=noopener>
<img src=/images/social/github.svg width=24 height=24 alt=github>
</a>
</span>
</div>
</div>
</div>
<script type=text/javascript src=/js/bundle.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js></script>
</body>
</html>